<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SortOrderItem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Comparator</a> &gt; <a href="index.source.html" class="el_package">org.bremersee.comparator.model</a> &gt; <span class="el_source">SortOrderItem.java</span></div><h1>SortOrderItem.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2019-2022 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.bremersee.comparator.model;

import static java.util.Objects.isNull;
import static java.util.Objects.nonNull;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonPropertyOrder;
import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.xml.bind.annotation.XmlAccessType;
import jakarta.xml.bind.annotation.XmlAccessorType;
import jakarta.xml.bind.annotation.XmlElement;
import jakarta.xml.bind.annotation.XmlRootElement;
import jakarta.xml.bind.annotation.XmlTransient;
import jakarta.xml.bind.annotation.XmlType;
import java.io.Serial;
import java.io.Serializable;
import java.util.Objects;
import java.util.Optional;
import lombok.EqualsAndHashCode;
import lombok.Getter;

/**
 * This class defines the sort order of a field.
 *
 * &lt;pre&gt;
 *  ---------------------------------------------------------------------------------------------
 * | Attribute    | Description                                                    | Default     |
 * |--------------|----------------------------------------------------------------|-------------|
 * | field        | The field name (or method name) of the object. It can be a     | null        |
 * |              | path. The segments are separated by a dot (.):                 |             |
 * |              | field0.field1.field2                                           |             |
 * |              | It can be null. Then the object itself must be comparable.     |             |
 * |--------------|----------------------------------------------------------------|-------------|
 * | direction    | Defines ascending or descending ordering.                      | asc         |
 * |--------------|----------------------------------------------------------------|-------------|
 * | caseHandling | Makes a case ignoring comparison (only for strings).           | insensitive |
 * |--------------|----------------------------------------------------------------|-------------|
 * | nullHandling | Defines the ordering if one of the values is null.             | last        |
 *  ---------------------------------------------------------------------------------------------
 * &lt;/pre&gt;
 *
 * &lt;p&gt;These values have a 'sort order text' representation. The values are concatenated with
 * comma ',' (default):
 * &lt;pre&gt;
 * fieldNameOrPath,direction,caseHandling,nullHandling
 * &lt;/pre&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;
 * properties.customSettings.priority,asc,insensitive,nulls-first
 * &lt;/pre&gt;
 *
 * &lt;p&gt;Defaults can be omitted. This is the same:
 * &lt;pre&gt;
 * properties.customSettings.priority
 * &lt;/pre&gt;
 *
 * &lt;p&gt;The building of a chain is done by concatenate the fields with a semicolon ';' (default):
 * &lt;pre&gt;
 * field0,desc;field1,desc
 * &lt;/pre&gt;
 *
 * @author Christian Bremer
 */
@XmlRootElement(name = &quot;sortOrderItem&quot;)
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = &quot;sortOrderItemType&quot;, propOrder = {
    &quot;field&quot;,
    &quot;direction&quot;,
    &quot;caseHandling&quot;,
    &quot;nullHandling&quot;
})
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonPropertyOrder(value = {
    &quot;field&quot;,
    &quot;direction&quot;,
    &quot;caseHandling&quot;,
    &quot;nullHandling&quot;
})
@Schema(description = &quot;A sort order defines how a field of an object is sorted.&quot;)
@Getter
@EqualsAndHashCode
public class SortOrderItem implements Serializable {

  @Serial
  private static final long serialVersionUID = 1;

  /**
   * The constant DEFAULT_SEPARATOR.
   */
  public static final String DEFAULT_SEPARATOR = &quot;,&quot;;

  /**
   * The constant DEFAULT_DIRECTION.
   */
<span class="fc" id="L115">  protected static final Direction DEFAULT_DIRECTION = Direction.ASC;</span>

  /**
   * The constant DEFAULT_CASE_HANDLING.
   */
<span class="fc" id="L120">  protected static final CaseHandling DEFAULT_CASE_HANDLING = CaseHandling.INSENSITIVE;</span>

  /**
   * The constant DEFAULT_NULL_HANDLING.
   */
<span class="fc" id="L125">  protected static final NullHandling DEFAULT_NULL_HANDLING = NullHandling.NATIVE;</span>

  /**
   * The field name or path. If it is {@code null}, the whole object will be compared.
   */
  @Schema(description = &quot;The field name or path.&quot;)
  @XmlElement(name = &quot;field&quot;)
  @JsonProperty(&quot;field&quot;)
  private final String field;

  /**
   * The direction. Default is {@link Direction#ASC}.
   */
  @Schema(description = &quot;The direction.&quot;)
  @XmlElement(name = &quot;direction&quot;, defaultValue = &quot;ASC&quot;)
  @JsonProperty(&quot;direction&quot;)
  private final Direction direction;

  /**
   * The case-handling. Default is {@link CaseHandling#INSENSITIVE}.
   */
  @Schema(description = &quot;The case-handling.&quot;)
  @XmlElement(name = &quot;case-handling&quot;, defaultValue = &quot;INSENSITIVE&quot;)
  @JsonProperty(&quot;case-handling&quot;)
  private final CaseHandling caseHandling;

  /**
   * The null-handling. Default is {@link NullHandling#NATIVE}.
   */
  @Schema(description = &quot;The null-handling.&quot;)
  @XmlElement(name = &quot;null-handling&quot;, defaultValue = &quot;NATIVE&quot;)
  @JsonProperty(&quot;null-handling&quot;)
  private final NullHandling nullHandling;

  /**
   * Instantiates a new sort order item.
   */
  protected SortOrderItem() {
<span class="fc" id="L163">    this(null, DEFAULT_DIRECTION, DEFAULT_CASE_HANDLING, DEFAULT_NULL_HANDLING);</span>
<span class="fc" id="L164">  }</span>

  /**
   * Instantiates a new sort order item.
   *
   * @param field the field name or path (can be {@code null})
   * @param direction the direction
   * @param caseHandling the case-handling
   * @param nullHandling the null-handling
   */
  @JsonCreator
  public SortOrderItem(
      @JsonProperty(&quot;field&quot;) String field,
      @JsonProperty(&quot;direction&quot;) Direction direction,
      @JsonProperty(&quot;case-handling&quot;) CaseHandling caseHandling,
<span class="fc" id="L179">      @JsonProperty(&quot;null-handling&quot;) NullHandling nullHandling) {</span>
<span class="fc bfc" id="L180" title="All 4 branches covered.">    this.field = isNull(field) || field.isBlank() ? null : field;</span>
<span class="fc" id="L181">    this.direction = Objects.requireNonNullElse(direction, DEFAULT_DIRECTION);</span>
<span class="fc" id="L182">    this.caseHandling = Objects.requireNonNullElse(caseHandling, DEFAULT_CASE_HANDLING);</span>
<span class="fc" id="L183">    this.nullHandling = Objects.requireNonNullElse(nullHandling, DEFAULT_NULL_HANDLING);</span>
<span class="fc" id="L184">  }</span>

  /**
   * Gets field (can be {@code null}).
   *
   * @return the field
   */
  public String getField() {
<span class="pc bpc" id="L192" title="1 of 4 branches missed.">    return isNull(field) || field.isBlank() ? null : field;</span>
  }

  /**
   * With given direction.
   *
   * @param direction the direction
   * @return the new sort order
   */
  public SortOrderItem with(Direction direction) {
<span class="fc" id="L202">    return Optional.ofNullable(direction)</span>
<span class="fc" id="L203">        .map(dir -&gt; new SortOrderItem(getField(), dir, getCaseHandling(), getNullHandling()))</span>
<span class="fc" id="L204">        .orElse(this);</span>
  }

  /**
   * With given case-handling.
   *
   * @param caseHandling the case-handling
   * @return the new sort order
   */
  public SortOrderItem with(CaseHandling caseHandling) {
<span class="fc" id="L214">    return Optional.ofNullable(caseHandling)</span>
<span class="fc" id="L215">        .map(ch -&gt; new SortOrderItem(getField(), getDirection(), ch, getNullHandling()))</span>
<span class="fc" id="L216">        .orElse(this);</span>
  }

  /**
   * With given null-handling.
   *
   * @param nullHandling the null-handling
   * @return the new sort order
   */
  public SortOrderItem with(NullHandling nullHandling) {
<span class="fc" id="L226">    return Optional.ofNullable(nullHandling)</span>
<span class="fc" id="L227">        .map(nh -&gt; new SortOrderItem(getField(), getDirection(), getCaseHandling(), nh))</span>
<span class="fc" id="L228">        .orElse(this);</span>
  }

  /**
   * Creates the sort order text of this ordering description.
   *
   * &lt;p&gt;The syntax of the ordering description is
   * &lt;pre&gt;
   * fieldNameOrPath;direction;caseHandling;nullHandling
   * &lt;/pre&gt;
   *
   * &lt;p&gt;For example
   * &lt;pre&gt;
   * person.lastName;asc;sensitive;nulls-first
   * &lt;/pre&gt;
   *
   * @return the sort order text
   */
  @JsonIgnore
  @XmlTransient
  public String getSortOrderText() {
<span class="fc" id="L249">    return getSortOrderText(SortOrderTextSeparators.defaults());</span>
  }

  /**
   * Creates the sort order text of this ordering description.
   *
   * &lt;p&gt;The syntax of the ordering description is
   * &lt;pre&gt;
   * fieldNameOrPath;direction;caseHandling;nullHandling
   * &lt;/pre&gt;
   *
   * &lt;p&gt;For example
   * &lt;pre&gt;
   * person.lastName;asc;sensitive;nulls-first
   * &lt;/pre&gt;
   *
   * @param separators the separators
   * @return the sort order text
   */
  public String getSortOrderText(SortOrderTextSeparators separators) {
<span class="fc" id="L269">    String separator = Optional.ofNullable(separators)</span>
<span class="fc" id="L270">        .orElseGet(SortOrderTextSeparators::defaults)</span>
<span class="fc" id="L271">        .getArgumentSeparator();</span>
<span class="fc" id="L272">    StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L273" title="All 2 branches covered.">    if (nonNull(getField())) {</span>
<span class="fc" id="L274">      sb.append(getField());</span>
    }
<span class="fc bfc" id="L276" title="All 2 branches covered.">    boolean isNullHandlingDefault = getNullHandling() == DEFAULT_NULL_HANDLING;</span>
<span class="fc bfc" id="L277" title="All 4 branches covered.">    boolean isCaseHandlingDefault = getCaseHandling() == DEFAULT_CASE_HANDLING</span>
        &amp;&amp; isNullHandlingDefault;
<span class="fc bfc" id="L279" title="All 4 branches covered.">    boolean isDirectionDefault = getDirection() == DEFAULT_DIRECTION &amp;&amp; isCaseHandlingDefault;</span>
<span class="fc bfc" id="L280" title="All 2 branches covered.">    if (!isDirectionDefault) {</span>
<span class="fc" id="L281">      sb.append(separator).append(getDirection().toString());</span>
    }
<span class="fc bfc" id="L283" title="All 2 branches covered.">    if (!isCaseHandlingDefault) {</span>
<span class="fc" id="L284">      sb.append(separator).append(getCaseHandling().toString());</span>
    }
<span class="fc bfc" id="L286" title="All 2 branches covered.">    if (!isNullHandlingDefault) {</span>
<span class="fc" id="L287">      sb.append(separator).append(getNullHandling().toString());</span>
    }
<span class="fc" id="L289">    return sb.toString();</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L294">    return getSortOrderText();</span>
  }

  /**
   * Creates a new sort order for the given field.
   *
   * @param field the field
   * @return the sort order
   */
  public static SortOrderItem by(String field) {
<span class="fc" id="L304">    return new SortOrderItem(</span>
        field, DEFAULT_DIRECTION, DEFAULT_CASE_HANDLING, DEFAULT_NULL_HANDLING);
  }

  /**
   * From sort order text.
   *
   * @param source the sort order text
   * @return the sort order
   */
  public static SortOrderItem fromSortOrderText(String source) {
<span class="fc" id="L315">    return fromSortOrderText(source, SortOrderTextSeparators.defaults());</span>
  }

  /**
   * From sort order text.
   *
   * @param source the sort order text
   * @param separators the separators
   * @return the sort order
   */
  public static SortOrderItem fromSortOrderText(String source, SortOrderTextSeparators separators) {
<span class="fc bfc" id="L326" title="All 2 branches covered.">    if (isNull(source)) {</span>
<span class="fc" id="L327">      return null;</span>
    }
<span class="fc" id="L329">    return Optional.of(source.trim())</span>
<span class="fc" id="L330">        .map(text -&gt; {</span>
<span class="fc" id="L331">          String separator = Optional.ofNullable(separators)</span>
<span class="fc" id="L332">              .orElseGet(SortOrderTextSeparators::defaults)</span>
<span class="fc" id="L333">              .getArgumentSeparator();</span>
          String field;
<span class="fc" id="L335">          Direction direction = DEFAULT_DIRECTION;</span>
<span class="fc" id="L336">          CaseHandling caseHandling = DEFAULT_CASE_HANDLING;</span>
<span class="fc" id="L337">          NullHandling nullHandling = DEFAULT_NULL_HANDLING;</span>
<span class="fc" id="L338">          int index = text.indexOf(separator);</span>
<span class="fc bfc" id="L339" title="All 2 branches covered.">          if (index &lt; 0) {</span>
<span class="fc" id="L340">            field = text.trim();</span>
          } else {
<span class="fc" id="L342">            field = text.substring(0, index).trim();</span>
<span class="fc" id="L343">            int from = index + separator.length();</span>
<span class="fc" id="L344">            index = text.indexOf(separator, from);</span>
<span class="fc bfc" id="L345" title="All 2 branches covered.">            if (index &lt; 0) {</span>
<span class="fc" id="L346">              direction = Direction.fromString(text.substring(from).trim());</span>
            } else {
<span class="fc" id="L348">              direction = Direction.fromString(text.substring(from, index).trim());</span>
<span class="fc" id="L349">              from = index + separator.length();</span>
<span class="fc" id="L350">              index = text.indexOf(separator, from);</span>
<span class="fc bfc" id="L351" title="All 2 branches covered.">              if (index &lt; 0) {</span>
<span class="fc" id="L352">                caseHandling = CaseHandling.fromString(text.substring(from).trim());</span>
              } else {
<span class="fc" id="L354">                caseHandling = CaseHandling.fromString(text.substring(from, index).trim());</span>
<span class="fc" id="L355">                from = index + separator.length();</span>
<span class="fc" id="L356">                nullHandling = NullHandling.fromString(text.substring(from).trim());</span>
              }
            }
          }
<span class="fc bfc" id="L360" title="All 2 branches covered.">          field = field.isEmpty() ? null : field;</span>
<span class="fc" id="L361">          return new SortOrderItem(field, direction, caseHandling, nullHandling);</span>
        })
<span class="fc" id="L363">        .orElseGet(SortOrderItem::new);</span>
  }

  /**
   * The direction.
   */
<span class="fc" id="L369">  public enum Direction {</span>

    /**
     * Ascending direction.
     */
<span class="fc" id="L374">    ASC,</span>

    /**
     * Descending direction.
     */
<span class="fc" id="L379">    DESC;</span>

    /**
     * Returns whether the direction is ascending.
     *
     * @return true if ascending, false otherwise.
     */
    public boolean isAscending() {
<span class="fc" id="L387">      return ASC.equals(this);</span>
    }

    /**
     * Returns whether the direction is descending.
     *
     * @return true if descending, false otherwise.
     */
    public boolean isDescending() {
<span class="fc" id="L396">      return DESC.equals(this);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L401">      return name().toLowerCase();</span>
    }

    /**
     * From string.
     *
     * @param direction the direction
     * @return the direction
     */
    public static Direction fromString(String direction) {
<span class="fc bfc" id="L411" title="All 2 branches covered.">      if (&quot;DESC&quot;.equalsIgnoreCase(direction)) {</span>
<span class="fc" id="L412">        return DESC;</span>
      }
<span class="fc" id="L414">      return ASC;</span>
    }
  }

  /**
   * The case-handling.
   */
<span class="fc" id="L421">  public enum CaseHandling {</span>

    /**
     * Insensitive case-handling.
     */
<span class="fc" id="L426">    INSENSITIVE,</span>

    /**
     * Sensitive case-handling.
     */
<span class="fc" id="L431">    SENSITIVE;</span>

    /**
     * Returns whether the case-handling is insensitive.
     *
     * @return true if insensitive, false otherwise.
     */
    public boolean isInsensitive() {
<span class="fc" id="L439">      return INSENSITIVE.equals(this);</span>
    }

    /**
     * Returns whether the case-handling is sensitive.
     *
     * @return true if sensitive, false otherwise.
     */
    public boolean isSensitive() {
<span class="fc" id="L448">      return SENSITIVE.equals(this);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L453">      return name().toLowerCase();</span>
    }

    /**
     * From string.
     *
     * @param caseHandling the case-handling
     * @return the case-handling
     */
    public static CaseHandling fromString(String caseHandling) {
<span class="fc bfc" id="L463" title="All 2 branches covered.">      if (&quot;SENSITIVE&quot;.equalsIgnoreCase(caseHandling)) {</span>
<span class="fc" id="L464">        return SENSITIVE;</span>
      }
<span class="fc" id="L466">      return INSENSITIVE;</span>
    }
  }

  /**
   * The null-handling.
   */
<span class="fc" id="L473">  public enum NullHandling {</span>

    /**
     * Nulls first handling.
     */
<span class="fc" id="L478">    NULLS_FIRST,</span>

    /**
     * Nulls last handling.
     */
<span class="fc" id="L483">    NULLS_LAST,</span>

    /**
     * Native null-handling.
     */
<span class="fc" id="L488">    NATIVE;</span>

    @Override
    public String toString() {
<span class="fc" id="L492">      return name().replace(&quot;_&quot;, &quot;-&quot;).toLowerCase();</span>
    }

    /**
     * Is null first.
     *
     * @return the boolean
     */
    public boolean isNullFirst() {
<span class="fc" id="L501">      return NULLS_FIRST.equals(this);</span>
    }

    /**
     * Is null last.
     *
     * @return the boolean
     */
    public boolean isNullLast() {
<span class="pc bpc" id="L510" title="1 of 2 branches missed.">      return !isNullFirst();</span>
    }

    /**
     * From string.
     *
     * @param nullHandling the null-handling
     * @return the null-handling
     */
    public static NullHandling fromString(String nullHandling) {
<span class="pc bpc" id="L520" title="1 of 2 branches missed.">      if (&quot;NULLS_FIRST&quot;.equalsIgnoreCase(nullHandling)</span>
<span class="fc bfc" id="L521" title="All 2 branches covered.">          || &quot;NULLS-FIRST&quot;.equalsIgnoreCase(nullHandling)</span>
<span class="pc bpc" id="L522" title="1 of 2 branches missed.">          || &quot;FIRST&quot;.equalsIgnoreCase(nullHandling)) {</span>
<span class="fc" id="L523">        return NULLS_FIRST;</span>
      }
<span class="fc bfc" id="L525" title="All 2 branches covered.">      if (&quot;NATIVE&quot;.equalsIgnoreCase(nullHandling)) {</span>
<span class="fc" id="L526">        return NATIVE;</span>
      }
<span class="fc" id="L528">      return NULLS_LAST;</span>
    }

  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>