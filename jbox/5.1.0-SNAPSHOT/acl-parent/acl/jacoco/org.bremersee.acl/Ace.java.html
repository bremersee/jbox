<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Ace.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Acl</a> &gt; <a href="index.source.html" class="el_package">org.bremersee.acl</a> &gt; <span class="el_source">Ace.java</span></div><h1>Ace.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2019 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.bremersee.acl;

import static java.util.Collections.unmodifiableSortedSet;
import static java.util.Objects.nonNull;

import java.util.Collection;
import java.util.List;
import java.util.Objects;
import java.util.SortedSet;
import java.util.TreeSet;
import lombok.EqualsAndHashCode;
import lombok.ToString;

/**
 * The access control entry.
 *
 * @author Christian Bremer
 */
public interface Ace {

  /**
   * The constant GUEST.
   */
  String GUEST = &quot;guest&quot;;

  /**
   * The constant USERS.
   */
  String USERS = &quot;users&quot;;

  /**
   * The constant ROLES.
   */
  String ROLES = &quot;roles&quot;;

  /**
   * The constant GROUPS.
   */
  String GROUPS = &quot;groups&quot;;

  /**
   * Builder ace builder.
   *
   * @return the ace builder
   */
  static AceBuilder builder() {
<span class="fc" id="L63">    return new AceBuilder();</span>
  }

  /**
   * Empty ace.
   *
   * @return the ace
   */
  static Ace empty() {
<span class="fc" id="L72">    return builder().build();</span>
  }

  /**
   * Determines whether guests have access.
   *
   * @return {@code true} if guests have access, otherwise {@code false}
   */
  boolean isGuest();

  /**
   * Gets users.
   *
   * @return the users
   */
  SortedSet&lt;String&gt; getUsers();

  /**
   * Gets roles.
   *
   * @return the roles
   */
  SortedSet&lt;String&gt; getRoles();

  /**
   * Gets groups.
   *
   * @return the groups
   */
  SortedSet&lt;String&gt; getGroups();

  /**
   * The ace builder.
   *
   * @author Christian Bremer
   */
  @ToString
  @EqualsAndHashCode
  class AceBuilder {

    private boolean guest;

<span class="fc" id="L114">    private final TreeSet&lt;String&gt; users = new TreeSet&lt;&gt;(String::compareToIgnoreCase);</span>

<span class="fc" id="L116">    private final TreeSet&lt;String&gt; roles = new TreeSet&lt;&gt;(String::compareToIgnoreCase);</span>

<span class="fc" id="L118">    private final TreeSet&lt;String&gt; groups = new TreeSet&lt;&gt;(String::compareToIgnoreCase);</span>

    /**
     * Instantiates a new ace builder.
     */
    public AceBuilder() {
<span class="fc" id="L124">      super();</span>
<span class="fc" id="L125">    }</span>

    /**
     * From ace builder.
     *
     * @param ace the ace
     * @return the ace builder
     */
    public AceBuilder from(Ace ace) {
<span class="fc bfc" id="L134" title="All 2 branches covered.">      if (nonNull(ace)) {</span>
<span class="fc" id="L135">        guest(ace.isGuest());</span>
<span class="fc" id="L136">        users(ace.getUsers());</span>
<span class="fc" id="L137">        roles(ace.getRoles());</span>
<span class="fc" id="L138">        groups(ace.getGroups());</span>
      }
<span class="fc" id="L140">      return this;</span>
    }

    /**
     * Guest ace builder.
     *
     * @param isGuest the is guest
     * @return the ace builder
     */
    public AceBuilder guest(boolean isGuest) {
<span class="fc" id="L150">      this.guest = isGuest;</span>
<span class="fc" id="L151">      return this;</span>
    }

    /**
     * Users ace builder.
     *
     * @param users the users
     * @return the ace builder
     */
    public AceBuilder users(Collection&lt;String&gt; users) {
<span class="fc" id="L161">      this.users.clear();</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">      return addUsers(nonNull(users) ? users : List.of());</span>
    }

    /**
     * Add users ace builder.
     *
     * @param users the users
     * @return the ace builder
     */
    public AceBuilder addUsers(Collection&lt;String&gt; users) {
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">      if (nonNull(users)) {</span>
<span class="fc" id="L173">        users.stream()</span>
<span class="pc bpc" id="L174" title="2 of 4 branches missed.">            .filter(entry -&gt; nonNull(entry) &amp;&amp; !entry.isBlank())</span>
<span class="fc" id="L175">            .forEach(this.users::add);</span>
      }
<span class="fc" id="L177">      return this;</span>
    }

    /**
     * Remove users ace builder.
     *
     * @param users the users
     * @return the ace builder
     */
    public AceBuilder removeUsers(Collection&lt;String&gt; users) {
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">      if (nonNull(users)) {</span>
<span class="fc" id="L188">        users.stream()</span>
<span class="fc" id="L189">            .filter(Objects::nonNull)</span>
<span class="fc" id="L190">            .forEach(this.users::remove);</span>
      }
<span class="fc" id="L192">      return this;</span>
    }

    /**
     * Roles ace builder.
     *
     * @param roles the roles
     * @return the ace builder
     */
    public AceBuilder roles(Collection&lt;String&gt; roles) {
<span class="fc" id="L202">      this.roles.clear();</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">      return addRoles(nonNull(roles) ? roles : List.of());</span>
    }

    /**
     * Add roles ace builder.
     *
     * @param roles the roles
     * @return the ace builder
     */
    public AceBuilder addRoles(Collection&lt;String&gt; roles) {
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">      if (nonNull(roles)) {</span>
<span class="fc" id="L214">        roles.stream()</span>
<span class="pc bpc" id="L215" title="2 of 4 branches missed.">            .filter(entry -&gt; nonNull(entry) &amp;&amp; !entry.isBlank())</span>
<span class="fc" id="L216">            .forEach(this.roles::add);</span>
      }
<span class="fc" id="L218">      return this;</span>
    }

    /**
     * Remove roles ace builder.
     *
     * @param roles the roles
     * @return the ace builder
     */
    public AceBuilder removeRoles(Collection&lt;String&gt; roles) {
<span class="pc bpc" id="L228" title="1 of 2 branches missed.">      if (nonNull(roles)) {</span>
<span class="fc" id="L229">        roles.stream()</span>
<span class="fc" id="L230">            .filter(Objects::nonNull)</span>
<span class="fc" id="L231">            .forEach(this.roles::remove);</span>
      }
<span class="fc" id="L233">      return this;</span>
    }

    /**
     * Groups ace builder.
     *
     * @param groups the groups
     * @return the ace builder
     */
    public AceBuilder groups(Collection&lt;String&gt; groups) {
<span class="fc" id="L243">      this.groups.clear();</span>
<span class="pc bpc" id="L244" title="1 of 2 branches missed.">      return addGroups(nonNull(groups) ? groups : List.of());</span>
    }

    /**
     * Add groups ace builder.
     *
     * @param groups the groups
     * @return the ace builder
     */
    public AceBuilder addGroups(Collection&lt;String&gt; groups) {
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">      if (nonNull(groups)) {</span>
<span class="fc" id="L255">        groups.stream()</span>
<span class="pc bpc" id="L256" title="2 of 4 branches missed.">            .filter(entry -&gt; nonNull(entry) &amp;&amp; !entry.isBlank())</span>
<span class="fc" id="L257">            .forEach(this.groups::add);</span>
      }
<span class="fc" id="L259">      return this;</span>
    }

    /**
     * Remove groups ace builder.
     *
     * @param groups the groups
     * @return the ace builder
     */
    public AceBuilder removeGroups(Collection&lt;String&gt; groups) {
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">      if (nonNull(groups)) {</span>
<span class="fc" id="L270">        groups.stream()</span>
<span class="fc" id="L271">            .filter(Objects::nonNull)</span>
<span class="fc" id="L272">            .forEach(this.groups::remove);</span>
      }
<span class="fc" id="L274">      return this;</span>
    }

    /**
     * Build ace.
     *
     * @return the ace
     */
    public Ace build() {
<span class="fc" id="L283">      return new AceImpl(guest, users, roles, groups);</span>
    }

  }

  /**
   * The ace implementation.
   *
   * @author Christian Bremer
   */
  @ToString
  @EqualsAndHashCode
  class AceImpl implements Ace {

    private final boolean guestFlag;

    private final SortedSet&lt;String&gt; userSet;

    private final SortedSet&lt;String&gt; roleSet;

    private final SortedSet&lt;String&gt; groupSet;

    private AceImpl(
        boolean guest,
        SortedSet&lt;String&gt; users,
        SortedSet&lt;String&gt; roles,
<span class="fc" id="L309">        SortedSet&lt;String&gt; groups) {</span>

<span class="fc" id="L311">      this.guestFlag = guest;</span>
<span class="fc" id="L312">      this.userSet = unmodifiableSortedSet(users);</span>
<span class="fc" id="L313">      this.roleSet = unmodifiableSortedSet(roles);</span>
<span class="fc" id="L314">      this.groupSet = unmodifiableSortedSet(groups);</span>
<span class="fc" id="L315">    }</span>

    @Override
    public boolean isGuest() {
<span class="fc" id="L319">      return guestFlag;</span>
    }

    @Override
    public SortedSet&lt;String&gt; getUsers() {
<span class="fc" id="L324">      return userSet;</span>
    }

    @Override
    public SortedSet&lt;String&gt; getRoles() {
<span class="fc" id="L329">      return roleSet;</span>
    }

    @Override
    public SortedSet&lt;String&gt; getGroups() {
<span class="fc" id="L334">      return groupSet;</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>